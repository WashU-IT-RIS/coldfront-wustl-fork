from coldfront.core.test_helpers.factories import AllocationAttributeUsageFactory

from coldfront.plugins.qumulo.tests.fixtures import (
    create_metadata_for_testing,
    create_ris_project_and_allocations_storage2,
    create_ris_project_and_allocations_storage3,
)


ITSM_ATTRIBUTES_FOR_BILLING = [
    "id",
    "sponsor",
    "fileset_name",
    "service_rate_category",
    "amount",
    "funding_number",
    "exempt",
    "subsidized",
    "is_condo_group",
    "parent_id",
    "quota",
    "billing_cycle",
    "billing_contact",
    "status",
    "provision_usage_creation_date",
]

COLDFRONT_PATH_FIXTURES = [
    "/storage2/fs1/daryls3",
    "/storage2/fs1/kdandurand",
    "/storage2/fs1/abrummett",
    "/storage2/fs1/rfugina",
    "/storage2/fs1/kirilloff",
    "/storage2/fs1/vtieppofrancio",
    "/storage2/fs1/yany",
    "/storage2/fs1/shaffique",
    "/storage2/fs1/kongf",
    "/storage2/fs1/dstrait",
    "/storage2/fs1/tunayilker",
    "/storage2/fs1/dricardo",
    "/storage2/fs1/RADONC-ViewRay",
    "/storage2/fs1/firsztj",
    "/storage2/fs1/zhour",
    "/storage2/fs1/satochihiro",
    "/storage2/fs1/hartman_m",
    "/storage2/fs1/leejm",
    "/storage2/fs1/guozhen",
    "/storage2/fs1/mingzhou.zhou",
    "/storage2/fs1/f.alex",
    "/storage2/fs1/cfritz",
    "/storage2/fs1/alirezag",
    "/storage2/fs1/RIS-Services",
    "/storage2/fs1/matthew.brier",
    "/storage2/fs1/hui",
    "/storage2/fs1/oren",
    "/storage2/fs1/hema.adhikari",
    "/storage2/fs1/djoshu",
    "/storage2/fs1/syidan",
    "/storage2/fs1/sdahiya",
    "/storage2/fs1/ariela",
    "/storage2/fs1/rtriplett",
    "/storage2/fs1/cfeliciano",
    "/storage2/fs1/margotm",
    "/storage2/fs1/wbuchser",
    "/storage2/fs1/DSG",
    "/storage2/fs1/hdean",
    "/storage2/fs1/lu",
    "/storage2/fs1/bol",
    "/storage2/fs1/aoestreich",
    "/storage2/fs1/x.cui",
    "/storage2/fs1/rpokorne2",
    "/storage2/fs1/mpagel",
    "/storage2/fs1/hex",
    "/storage2/fs1/gomes",
    "/storage2/fs1/sanadkaram",
    "/storage2/fs1/bphilip",
    "/storage2/fs1/abby.green",
    "/storage2/fs1/r.lawrence",
    "/storage2/fs1/rgovindan",
    "/storage2/fs1/cspohl-ris",
    "/storage2/fs1/cspohl",
    "/storage2/fs1/struck",
    "/storage2/fs1/groves.a",
    "/storage2/fs1/christopherking",
    "/storage2/fs1/erabinowitz",
    "/storage2/fs1/sibley",
    "/storage2/fs1/hellerk",
    "/storage2/fs1/UMD",
    "/storage2/fs1/e.g.schmitt",
    "/storage2/fs1/ted",
    "/storage2/fs1/akiu",
    "/storage2/fs1/fuzhongzhang",
    "/storage2/fs1/faccior",
    "/storage2/fs1/apte",
    "/storage2/fs1/jin810-2",
    "/storage2/fs1/xing.huang",
    "/storage2/fs1/joshua.yuan",
    "/storage2/fs1/milbourn",
    "/storage2/fs1/gunnar",
    "/storage2/fs1/brettd",
    "/storage2/fs1/mgalford",
    "/storage2/fs1/lilijin",
    "/storage2/fs1/cpottier",
    "/storage2/fs1/hu.h",
    "/storage2/fs1/mmitreva4",
    "/storage2/fs1/thomasn",
    "/storage2/fs1/dmann",
    "/storage2/fs1/pakrasi",
    "/storage2/fs1/japrewitt",
    "/storage2/fs1/a.wilcox",
    "/storage2/fs1/harterj",
    "/storage2/fs1/r2p2-core-b",
    "/storage2/fs1/jrturner",
    "/storage2/fs1/ioannisk",
    "/storage2/fs1/shen.m",
    "/storage2/fs1/zimmero",
    "/storage2/fs1/jankowsky",
    "/storage2/fs1/cahsper",
    "/storage2/fs1/dt-summer-corp",
    "/storage2/fs1/kanjee",
    "/storage2/fs1/hirbea",
    "/storage2/fs1/campisi",
    "/storage2/fs1/i2db-students",
    "/storage2/fs1/r.thompson",
    "/storage2/fs1/curtismegan",
    "/storage2/fs1/flare",
    "/storage2/fs1/bfrauch",
    "/storage2/fs1/igegeorge",
    "/storage2/fs1/jjez",
    "/storage2/fs1/j.jackson",
    "/storage2/fs1/hayashi_r",
    "/storage2/fs1/saifus",
    "/storage2/fs1/knittelj",
    "/storage2/fs1/kevin.hsueh",
    "/storage2/fs1/r.schwarzlose",
    "/storage2/fs1/jaolson",
    "/storage2/fs1/brianallen",
    "/storage2/fs1/borcherding.n",
    "/storage2/fs1/barthelemy.nicolas",
    "/storage2/fs1/seungjong",
    "/storage2/fs1/leeay",
    "/storage2/fs1/sutcliffes",
    "/storage2/fs1/ziao",
    "/storage2/fs1/wadle",
    "/storage2/fs1/zting",
    "/storage2/fs1/IMSE",
    "/storage2/fs1/j.oltmanns",
    "/storage2/fs1/xukeviny",
    "/storage2/fs1/laumannt",
    "/storage2/fs1/jzellers",
    "/storage2/fs1/vandillenl",
    "/storage2/fs1/nyssafarrell",
    "/storage2/fs1/erichuang",
    "/storage2/fs1/pengp",
    "/storage2/fs1/dong.f",
    "/storage2/fs1/pzolkind",
    "/storage2/fs1/j.mengmeng",
    "/storage2/fs1/bwahle",
    "/storage2/fs1/yingkang",
    "/storage2/fs1/pdev",
    "/storage2/fs1/kwylie",
    "/storage2/fs1/cke",
    "/storage2/fs1/fyingying",
    "/storage2/fs1/marilia",
    "/storage2/fs1/priyapal",
    "/storage2/fs1/emarti",
    "/storage2/fs1/l.feng",
    "/storage2/fs1/shaox",
    "/storage2/fs1/deselmc",
    "/storage2/fs1/flagunasvargas",
    "/storage2/fs1/elyn",
]

USAGES_IN_BYTES = [
    "36829437952",
    "16384",
    "20480",
    "20480",
    "28672",
    "20480",
    "204800",
    "773895806976",
    "36864",
    "3272675704832",
    "20480",
    "5165220356096",
    "2352006463488",
    "1606071357440",
    "3887576907776",
    "101666816",
    "278774325248",
    "2411355860992",
    "2351291797504",
    "16384",
    "652909109248",
    "27111424",
    "4059843129344",
    "1072781049856",
    "112110813184",
    "3996178960384",
    "2973675520",
    "9469952",
    "16384",
    "1384111996928",
    "154450948096",
    "376905879552",
    "318075281408",
    "97476608",
    "112081887232",
    "7796219117568",
    "17393954209792",
    "23038849024",
    "10354247196672",
    "16384",
    "213593182208",
    "50505216225280",
    "2042485161984",
    "7991296",
    "358666240",
    "135939784704",
    "24806050066432",
    "23402908368896",
    "4323452416000",
    "2081896845312",
    "86172047065088",
    "290816",
    "3209166848",
    "16384",
    "4669530394624",
    "3760586190848",
    "390930432",
    "23541073657856",
    "147456",
    "901269458944",
    "2890680307712",
    "16384",
    "2520980844544",
    "60538302464",
    "141490200576",
    "29845355470848",
    "16384",
    "4163092865024",
    "321266421760",
    "96373309440",
    "228675866624",
    "16384",
    "13805232128",
    "233544998912",
    "16384",
    "16384",
    "5723923275776",
    "26525696",
    "982096855040",
    "16384",
    "5407670272",
    "427237601280",
    "2471202816",
    "156517122048",
    "7181270847488",
    "9130266624",
    "172341587968",
    "16384",
    "5156305825792",
    "1415057408",
    "3613463048192",
    "24576",
    "36832545693696",
    "4842817884160",
    "1018118144",
    "402415194112",
    "154109652992",
    "16384",
    "16384",
    "133443584",
    "1470882054144",
    "1244565667840",
    "165859328",
    "92405760",
    "897024",
    "133982969856",
    "20259987456",
    "2891481542656",
    "22499328",
    "16384",
    "2030233645056",
    "82895216640",
    "2605537476608",
    "107511808",
    "16384",
    "5402624",
    "2444517376",
    "13134901248",
    "7766888448",
    "499543969792",
    "16384",
    "2705236008960",
    "556235653120",
    "20480",
    "16384",
    "16384",
    "3360735232",
    "3182318489600",
    "16384",
    "149049376768",
    "32768",
    "16384",
    "979131797504",
    "1467158528",
    "16384",
    "13104824283136",
    "39219765248",
    "16384",
    "24390131712",
    "3513225216",
    "107032219648",
    "16384",
    "1243250688",
]

USERNAME_FIXTURES = [
    "daryls",
    "kdandurand",
    "abrummett",
    "rfugina",
    "kirilloff",
    "vtieppofrancio",
    "yany",
    "shaffique",
    "kongf",
    "dstrait",
    "tunayilker",
    "dricardo",
    "zhut",
    "firsztj",
    "zhour",
    "satochihiro",
    "hartman_m",
    "leejm",
    "guozhen",
    "mingzhou.zhou",
    "f.alex",
    "cfritz",
    "alirezag",
    "cspohl",
    "matthew.brier",
    "hui",
    "oren",
    "hema.adhikari",
    "djoshu",
    "syidan",
    "sdahiya",
    "ariela",
    "rtriplett",
    "cfeliciano",
    "margotm",
    "wbuchser",
    "mprovince",
    "hdean",
    "lu",
    "bol",
    "aoestreich",
    "x.cui",
    "rpokorne",
    "mpagel",
    "hex",
    "gomes",
    "sanadkaram",
    "bphilip",
    "abby.green",
    "r.lawrence",
    "rgovindan",
    "cspohl",
    "cspohl",
    "struck",
    "groves.a",
    "christopherking",
    "erabinowitz",
    "sibley",
    "hellerk",
    "dbaldri",
    "e.g.schmitt",
    "ted",
    "akiu",
    "fuzhongzhang",
    "faccior",
    "apte",
    "rouse",
    "xing.huang",
    "joshua.yuan",
    "milbourn",
    "gunnar",
    "brettd",
    "mgalford",
    "lilijin",
    "cpottier",
    "hu.h",
    "mmitreva",
    "thomasn",
    "dmann",
    "pakrasi",
    "japrewitt",
    "a.wilcox",
    "harterj",
    "jphilipmiller",
    "jrturner",
    "ioannisk",
    "shen.m",
    "zimmero",
    "jankowsky",
    "kjoyntmaddox",
    "mdan",
    "kanjee",
    "hirbea",
    "campisi",
    "yenp",
    "r.thompson",
    "curtismegan",
    "cwgoss",
    "bfrauch",
    "igegeorge",
    "jjez",
    "j.jackson",
    "hayashi_r",
    "saifus",
    "knittelj",
    "kevin.hsueh",
    "r.schwarzlose",
    "jaolson",
    "brianallen",
    "borcherding.n",
    "barthelemy.nicolas",
    "seungjong",
    "leeay",
    "sutcliffes",
    "ziao",
    "wadle",
    "zting",
    "floresk",
    "j.oltmanns",
    "xukeviny",
    "laumannt",
    "jzellers",
    "vandillenl",
    "nyssafarrell",
    "erichuang",
    "pengp",
    "dong.f",
    "pzolkind",
    "j.mengmeng",
    "bwahle",
    "yingkang",
    "pdev",
    "kwylie",
    "cke",
    "fyingying",
    "marilia",
    "priyapal",
    "emarti",
    "l.feng",
    "shaox",
    "deselmc",
    "flagunasvargas",
    "elyn",
]


def create_coldfront_allocations_with_usages() -> None:
    create_metadata_for_testing()
    for storage_filesystem_path, usage_bytes, pi_username in zip(
        COLDFRONT_PATH_FIXTURES, USAGES_IN_BYTES, USERNAME_FIXTURES
    ):
        _, allocations = create_ris_project_and_allocations_storage2(
            storage_filesystem_path=storage_filesystem_path, pi_username=pi_username
        )
        AllocationAttributeUsageFactory(
            allocation_attribute=allocations[
                "storage_allocation"
            ].allocationattribute_set.get(
                allocation_attribute_type__name="storage_quota"
            ),
            value=int(usage_bytes),
        )

    # active storage3 allocation
    _, allocations = create_ris_project_and_allocations_storage3(
        storage_filesystem_path="/storage3/fs1/testuser",
    )
    AllocationAttributeUsageFactory(
        allocation_attribute=allocations[
            "storage_allocation"
        ].allocationattribute_set.get(allocation_attribute_type__name="storage_quota"),
        value=36829437952,
    )

    # pending storage3 allocation
    _, allocations = create_ris_project_and_allocations_storage3(
        storage_filesystem_path="/storage3/fs1/inactiveuser", pending=True
    )
    AllocationAttributeUsageFactory(
        allocation_attribute=allocations[
            "storage_allocation"
        ].allocationattribute_set.get(allocation_attribute_type__name="storage_quota"),
        value=20480,
    )

    # pending storage2 allocation
    _, allocations = create_ris_project_and_allocations_storage2(
        "/storage2/fs1/inactiveuser2", pending=True
    )
    AllocationAttributeUsageFactory(
        allocation_attribute=allocations[
            "storage_allocation"
        ].allocationattribute_set.get(allocation_attribute_type__name="storage_quota"),
        value=20480,
    )
